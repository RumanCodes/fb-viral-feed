<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Viral Feed ¬∑ In-depth</title>
  <!-- Fonts: Geist (sans) + Instrument Serif (serif for titles) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Geist:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <link rel="stylesheet" href="../assets/css/viral.css">
  <style>
    
    /* ---------- DESIGN TOKENS ---------- */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-body:linear-gradient(270deg,
rgba(255, 183, 77, 0.12) 0%,
rgba(255, 138, 101, 0.10) 15%,
rgba(244, 143, 177, 0.10) 30%,
rgba(186, 104, 200, 0.10) 45%,
rgba(129, 140, 248, 0.10) 60%,
rgba(79, 195, 247, 0.10) 75%,
rgba(77, 182, 172, 0.10) 90%,
rgba(255, 183, 77, 0.12) 100%
), #fff;
      --bg-surface: #ffffff;
      --bg-surface-hover: #f2f5f9;
      --bg-elevated: #f0f3f8;
      --border-light: rgba(0, 0, 0, 0.06);
      --border-medium: rgba(0, 0, 0, 0.1);
      --text-primary: #1e293b;
      --text-secondary: #475569;
      --text-tertiary: #64748b;
      --accent: #e99c1a;
      --accent-soft: #dbeafe;
      --accent-text: #2563eb;
      --green: #10b981;
      --green-soft: #d1fae5;
      --red: #ef4444;
      --amber: #f59e0b;
      --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.03), 0 1px 2px rgba(0, 0, 0, 0.05);
      --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.05), 0 2px 4px rgba(0, 0, 0, 0.03);
      --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.08);
      --radius-md: 12px;
      --radius-lg: 20px;
      --radius-full: 999px;
      --font-sans: 'Geist', -apple-system, BlinkMacSystemFont, sans-serif;
      --font-serif: 'Instrument Serif', Georgia, serif;
      --transition: 0.2s cubic-bezier(0.2, 0, 0, 1);
    }

    [data-theme="dark"] {
      --bg-body: #0b0e14;
      --bg-surface: #151a24;
      --bg-surface-hover: #1e2632;
      --bg-elevated: #1b212c;
      --border-light: rgba(255, 255, 255, 0.06);
      --border-medium: rgba(255, 255, 255, 0.12);
      --text-primary: #f1f5f9;
      --text-secondary: #cbd5e1;
      --text-tertiary: #94a3b8;
      --accent: #3b82f6;
      --accent-soft: #1e3a5f;
      --accent-text: #60a5fa;
      --green: #22c55e;
      --green-soft: #1e3a2f;
      --red: #f87171;
      --amber: #fbbf24;
      --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.5);
      --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.6);
    }

    body {
      font-family: var(--font-sans);
      background: var(--bg-body);
      color: var(--text-primary);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      transition: background 0.2s, color 0.2s;
      /* subtle global perspective for 3D children */
      perspective: 1200px;
    }

    /* main layout */
    .app {
      max-width: 1440px;
      margin: 0 auto;
      padding: 0 24px;
    }

    /* ----- header (sticky, glass) ----- */
    .header {
      position: sticky;
      top: 0;
      z-index: 50;
      background: color-mix(in srgb, var(--bg-surface) 70%, transparent);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border-light);
      padding: 12px 0;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      justify-content: space-around;
    }

    .logo-group {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 8px;
      transform-style: preserve-3d;
      transition: transform var(--transition);
    }
    .logo:hover {
      transform: rotateY(6deg) rotateX(2deg) translateZ(10px);
    }

    .logo-icon {
      width: 36px;
      height: 36px;
      background: linear-gradient(145deg, #ffad24, #ffffff);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      box-shadow: 0 8px 16px rgba(59, 130, 246, 0.3);
    }

    .logo-text {
      font-weight: 700;
      font-size: 1.3rem;
      letter-spacing: -0.02em;
    }
    .logo-text span { color: var(--accent-text); }

    .live-badge {
      display: flex;
      align-items: center;
      gap: 6px;
      background: var(--green-soft);
      color: var(--green);
      border-radius: var(--radius-full);
      padding: 4px 12px;
      font-size: 0.7rem;
      font-weight: 700;
      text-transform: uppercase;
      border: 1px solid rgba(16, 185, 129, 0.3);
    }
    .live-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: currentColor;
      animation: pulse 2s infinite;
    }
    @keyframes pulse { 0%,100%{ opacity:1 } 50%{ opacity:0.3 } }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    #next-lbl {
      font-size: 0.8rem;
      color: var(--text-tertiary);
      background: var(--bg-surface);
      padding: 6px 16px;
      border-radius: var(--radius-full);
      border: 1px solid var(--border-light);
      box-shadow: var(--shadow-sm);
    }

    .theme-btn {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      background: var(--bg-surface);
      border: 1px solid var(--border-light);
      color: var(--text-secondary);
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: 0.15s;
      box-shadow: var(--shadow-sm);
    }
    .theme-btn:hover {
      background: var(--bg-surface-hover);
      border-color: var(--border-medium);
      transform: scale(1.05);
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 20px;
      border-radius: var(--radius-full);
      font-weight: 600;
      font-size: 0.85rem;
      border: none;
      cursor: pointer;
      transition: all 0.15s;
      background: var(--bg-surface);
      color: var(--text-primary);
      border: 1px solid var(--border-light);
      box-shadow: var(--shadow-sm);
    }
    .btn-primary {
      background: var(--accent);
      color: white;
      border: none;
      box-shadow: 0 8px 18px rgba(59, 130, 246, 0.3);
    }
    .btn-primary:hover {
      background: #4f8af7;
      transform: translateY(-1px) scale(1.02);
    }

    /* Ribbon Container - masks overflow */
    .ribbon-wrapper {
      width: 100%;
      max-width: 100vw;
      overflow: hidden;
      padding: 40px 0;
      mask-image: linear-gradient(
        to right,
        transparent,
        black 10%,
        black 90%,
        transparent
      );
      -webkit-mask-image: linear-gradient(
        to right,
        transparent,
        black 10%,
        black 90%,
        transparent
      );
    }

    /* Track that animates */
    .ribbon-track {
      display: flex;
      gap: 20px;
      width: max-content;
      animation: scroll 10s linear infinite;
    }

    /* Pause animation on hover */
    .ribbon-track:hover {
      animation-play-state: paused;
    }

    /* Keyframes for infinite scroll */
    @keyframes scroll {
      0% {
        transform: translateX(0);
      }
      100% {
        transform: translateX(-50%);
      }
    }

    /* Stats Ribbon */
    #ribbon {
      display: flex;
      gap: 20px;
      position: relative;
    }

    /* 3D Stat Card */
    .stat-card {
      display: flex;
      align-items: center;
      background: burlywood;
    padding: .4rem 4rem;
    border-radius: 5px;
    flex-direction: column;

     transform: perspective(800px) rotateY(0deg);
      transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
      cursor: pointer;
      min-width: 200px;
      flex-shrink: 0;
      position: relative;
    }

    .stat-emoji {
      font-size: 20px;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
      transition: transform 0.3s ease;
    }

    .stat-card:hover .stat-emoji {
      transform: scale(1.2) rotate(5deg);
    }

    .stat-info {
      display: flex;
    flex-direction: row;
    gap: 5px;
    align-items: center;
    }

    .stat-label {
      font-size: 12px;
      font-weight: 500;
      color: rgba(255, 255, 255, 0.6);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .stat-value {
      font-size: 22px;
      font-weight: 700;
      color: #fff;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    .stat-card {
      position: relative;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .stat-card {
        padding: 14px 20px;
        min-width: 150px;
      }
      .stat-emoji {
        font-size: 16px;
      }
      .stat-value {
        font-size: 18px;
      }
      .stat-label {
        font-size: 10px;
      }
    }

    
    /* ----- tabs ----- */
    .tabs {
      display: flex;
      gap: 4px;
      border-bottom: 1px solid var(--border-light);
      margin-bottom: 24px;
    }
    .tab {
      padding: 12px 24px;
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--text-tertiary);
      border-bottom: 2px solid transparent;
      cursor: pointer;
      background: transparent;
      border: none;
      transition: 0.15s;
    }
    .tab:hover { color: var(--text-secondary); }
    .tab.active {
      color: var(--accent-text);
      border-bottom-color: var(--accent);
    }

    /* ----- filter bar (clean, integrated) ----- */
    #toolbar {
      background: var(--bg-surface);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      padding: 16px 20px;
      margin-bottom: 28px;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
      box-shadow: var(--shadow-sm);
    }

    .search-wrapper {
      position: relative;
      flex: 2;
      min-width: 240px;
    }
    .search-icon {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-tertiary);
      width: 18px;
      height: 18px;
    }
    .search-wrapper input {
      width: 100%;
      padding: 12px 20px 12px 44px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-full);
      font-size: 0.9rem;
      color: var(--text-primary);
      outline: none;
      transition: 0.15s;
    }
    .search-wrapper input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-soft);
    }

    .filter-group {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    .pill {
      padding: 6px 18px;
      border-radius: var(--radius-full);
      font-size: 0.8rem;
      font-weight: 600;
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      color: var(--text-secondary);
      cursor: pointer;
      transition: 0.1s;
    }
    .pill.active {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
    }
    .pill:hover {
      background: var(--accent);
      color: var(--accent-soft);
      transform: scale(1.02);
    }

    select {
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-full);
      padding: 10px 32px 10px 16px;
      font-size: 0.85rem;
      color: var(--text-primary);
      cursor: pointer;
      outline: none;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20' stroke='%2364748b'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      background-size: 16px;
    }
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-soft);
    }

    /* result bar */
    #rbar {
      font-size: 0.85rem;
      color: var(--text-tertiary);
      margin: 0 0 12px 6px;
    }

    /* ----- feed grid (with 3D perspective) ----- */
    #feed {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 28px;
      margin-bottom: 60px;
      transform-style: preserve-3d;
    }

    /* card ‚Äì with 3D tilt effect */
    .card {
      background: var(--bg-surface);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      overflow: hidden;
      transition: transform 0.25s var(--transition), box-shadow 0.25s;
      display: flex;
      flex-direction: column;
      box-shadow: var(--shadow-sm);
      transform-style: preserve-3d;
      will-change: transform;
    }
    .card:hover {
      box-shadow: var(--shadow-lg);
      border-color: var(--border-medium);
    }

    .thumb {
      position: relative;
      aspect-ratio: 16/10;
      background: var(--bg-elevated);
      overflow: hidden;
      transform-style: preserve-3d;
    }
    .thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s;
    }
    .card:hover .thumb img {
      transform: scale(1.03);
    }
    .thumb-stripe {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--accent);
      opacity: 0.7;
      transform: translateZ(5px);
    }
    .thumb-badge {
      position: absolute;
      bottom: 12px;
      right: 12px;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      color: white;
      padding: 2px 10px;
      border-radius: var(--radius-full);
      font-size: 0.6rem;
      font-weight: 700;
      border: 1px solid rgba(255,255,255,0.2);
      transform: translateZ(8px);
    }
    .no-image {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: var(--text-tertiary);
      font-size: 2rem;
    }

    .card-content {
      padding: 20px 18px 18px;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 12px;
      transform: translateZ(5px);
    }

    .meta {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.7rem;
    }
    .source-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--accent);
      transform: translateZ(3px);
    }
    .source-name {
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.03em;
      color: var(--text-secondary);
    }
    .time {
      margin-left: auto;
      color: var(--text-tertiary);
      font-variant-numeric: tabular-nums;
    }

    .title {
      font-family: var(--font-serif);
      font-size: 1.2rem;
      line-height: 1.45;
      color: var(--text-primary);
      font-weight: 400;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .desc {
      font-size: 0.8rem;
      color: var(--text-secondary);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .card-footer {
      display: flex;
      justify-content: flex-end;
      padding-top: 14px;
      margin-top: auto;
      border-top: 1px solid var(--border-light);
    }
    .read-link {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--accent-text);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: gap 0.15s;
    }
    .read-link:hover { gap: 8px; }

    /* empty / loading */
    .fullcol { grid-column: 1/-1; }
    .empty-state {
      background: var(--bg-surface);
      border-radius: var(--radius-lg);
      padding: 60px 20px;
      text-align: center;
      border: 1px solid var(--border-light);
      color: var(--text-tertiary);
    }
    .spin {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border-light);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: rot 0.6s linear infinite;
      margin: 0 auto 16px;
    }
    @keyframes rot { to { transform: rotate(360deg); } }

    /* ----- source manager panel (modern card stack) ----- */
    #panel {
      display: none;
      flex-direction: column;
      gap: 24px;
      margin: 32px 0 60px;
    }
    #panel.on { display: flex; }

    .pcard {
      background: var(--bg-surface);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-sm);
      transition: transform 0.2s;
    }
    .pcard:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .phead {
      padding: 20px 24px;
      background: var(--bg-elevated);
      border-bottom: 1px solid var(--border-light);
    }
    .phead h3 {
      font-size: 1.1rem;
      font-weight: 700;
    }
    .phead p {
      font-size: 0.8rem;
      color: var(--text-tertiary);
      margin-top: 4px;
    }
    .pbody {
      padding: 24px;
    }

    .input-row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }
    .input-row input, .input-row select {
      flex: 1;
      min-width: 160px;
      padding: 12px 16px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-full);
      font-size: 0.85rem;
      color: var(--text-primary);
    }
    .input-row input[type="color"] {
      width: 50px;
      min-width: 50px;
      height: 46px;
      padding: 4px;
      border-radius: var(--radius-md);
    }

    .rbox {
      margin-top: 20px;
      border-radius: var(--radius-lg);
      padding: 16px 20px;
      border: 1px solid;
      display: none;
    }
    .rbox.on { display: block; }
    .rbox.ok { background: var(--green-soft); border-color: rgba(16,185,129,0.2); color: var(--green); }
    .rbox.err { background: rgba(239,68,68,0.1); border-color: rgba(239,68,68,0.2); color: var(--red); }
    .rbox.warn { background: rgba(245,158,11,0.1); border-color: rgba(245,158,11,0.2); color: var(--amber); }

    .altrow {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      background: var(--bg-elevated);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-light);
      margin-top: 12px;
      cursor: pointer;
      transition: 0.1s;
    }
    .altrow:hover {
      background: var(--accent-soft);
      border-color: var(--accent);
      transform: scale(1.01);
    }

    .srclist {
      max-height: 360px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .srcrow {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      background: var(--bg-elevated);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-light);
    }
    .srcrm {
      background: transparent;
      border: none;
      color: var(--text-tertiary);
      font-size: 0.8rem;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: var(--radius-full);
    }
    .srcrm:hover {
      background: rgba(239,68,68,0.1);
      color: var(--red);
    }

    /* toast */
    #toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--bg-surface);
      border: 1px solid var(--border-medium);
      border-radius: var(--radius-full);
      padding: 12px 24px;
      font-size: 0.85rem;
      font-weight: 500;
      box-shadow: var(--shadow-lg);
      opacity: 0;
      transform: translateY(10px);
      transition: 0.2s;
      z-index: 999;
      pointer-events: none;
    }
    #toast.show { opacity: 1; transform: translateY(0); }
    #toast.ok { border-color: var(--green); color: var(--green); }
    #toast.err { border-color: var(--red); color: var(--red); }

    /* mobile */
    @media (max-width: 640px) {
      .app { padding: 0 16px; }
      .header { flex-wrap: wrap; gap: 12px; }
      #ribbon { gap: 12px; }
      .stat-card { padding: 12px 18px; }
    }

    /* respect motion preferences */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        transition-duration: 0.01ms !important;
      }
    }
  </style>
</head>
<body>
<div class="app">
  <!-- header -->
  <header class="header">
    <div class="logo-group">
      <div class="logo">
        <div class="logo-icon">üì°</div>
        <span class="logo-text">Viral <span>Feed</span></span>
      </div>
      <div class="live-badge"><span class="live-dot"></span> Live</div>
    </div>
    <div class="header-actions">
      <span id="next-lbl"></span>
      <button class="theme-btn" onclick="toggleTheme()" title="Toggle theme">‚òÄÔ∏è</button>
      <button class="btn btn-primary" id="fbtn" onclick="fetchNow()">‚ö° Fetch now</button>
    </div>
  </header>

 <div class="ribbon-wrapper">
    <div id="ribbon">
      <div class="stat-card">
        <span class="stat-emoji">üì∞</span>
        <div class="stat-info">
          <span class="stat-label">Articles</span>
          <span class="stat-value" id="st">1,247</span>
        </div>
      </div>
      <div class="stat-card">
        <span class="stat-emoji">üñºÔ∏è</span>
        <div class="stat-info">
          <span class="stat-label">With images</span>
          <span class="stat-value" id="si">892</span>
        </div>
      </div>
      <div class="stat-card">
        <span class="stat-emoji">üì°</span>
        <div class="stat-info">
          <span class="stat-label">Sources</span>
          <span class="stat-value" id="ss">56</span>
        </div>
      </div>
      <div class="stat-card">
        <span class="stat-emoji">üè∑Ô∏è</span>
        <div class="stat-info">
          <span class="stat-label">Categories</span>
          <span class="stat-value" id="sc">24</span>
        </div>
      </div>
      <div class="stat-card">
        <span class="stat-emoji">üïí</span>
        <div class="stat-info">
          <span class="stat-label">Updated</span>
          <span class="stat-value" id="su">2 min ago</span>
        </div>
      </div>
    </div>
  </div>

  <!-- tabs -->
  <div class="tabs">
    <button class="tab active" role="tab" aria-selected="true" onclick="tab('feed',this)">Feed</button>
    <button class="tab" role="tab" aria-selected="false" onclick="tab('mgr',this)">Source Manager</button>
  </div>

  <!-- filter toolbar -->
  <div id="toolbar">
    <div class="search-wrapper">
      <svg class="search-icon" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="9" r="7"/><path d="m15 15 4 4"/></svg>
      <input type="text" id="q" placeholder="Search headlines‚Ä¶" oninput="filter()" aria-label="Search">
    </div>
    <div class="filter-group" id="cpills">
      <div class="pill active" data-c="all" onclick="setCat(this)">All</div>
    </div>
    <select id="sf" onchange="filter()">
      <option value="all">All Sources</option>
    </select>
    <select id="so" onchange="filter()">
      <option value="date">Newest first</option>
      <option value="source">By source</option>
    </select>
    <button class="btn btn-secondary" onclick="loadPosts()">‚Üª Refresh</button>
  </div>

  <!-- result count -->
  <div id="rbar"></div>

  <!-- feed grid (with 3D cards) -->
  <div id="feed" role="main"></div>

  <!-- source manager panel -->
  <div id="panel">
    <!-- find rss -->
    <div class="pcard">
      <div class="phead"><h3>üîç Find RSS</h3><p>Type publication name (e.g., NASA, BBC) ‚Äî get feed suggestions</p></div>
      <div class="pbody">
        <div class="input-row">
          <input type="text" id="fbin" placeholder="e.g. NASA, BBC, The Verge">
          <button class="btn btn-primary" onclick="findAlt()">Find</button>
        </div>
        <div id="altbox"></div>
      </div>
    </div>
    <!-- test feed -->
    <div class="pcard">
      <div class="phead"><h3>‚úÖ Test feed URL</h3><p>Validate any RSS, YouTube, Reddit feed</p></div>
      <div class="pbody">
        <div class="input-row">
          <input type="text" id="turl" placeholder="https://.../feed">
          <button class="btn btn-primary" id="tbtn" onclick="testFeed()">Test</button>
        </div>
        <div id="tbox" class="rbox"></div>
      </div>
    </div>
    <!-- add source -->
    <div class="pcard">
      <div class="phead"><h3>‚ûï Add source</h3><p>Manually add a working feed</p></div>
      <div class="pbody">
        <div class="input-row">
          <input type="text" id="aname" placeholder="Source name">
          <input type="text" id="acat" placeholder="Category">
          <input type="color" id="acolor" value="#3b82f6">
        </div>
        <div class="input-row" style="margin-top:12px">
          <input type="text" id="aurl" placeholder="Feed URL">
          <button class="btn btn-primary" id="abtn" onclick="addSrc()">Add</button>
        </div>
        <div id="abox" class="rbox"></div>
      </div>
    </div>
    <!-- active sources -->
    <div class="pcard">
      <div class="phead"><h3>üìã Active sources</h3><p>Your configured feeds</p></div>
      <div class="pbody">
        <div class="srclist" id="srclist">Loading‚Ä¶</div>
      </div>
    </div>
  </div>
</div>

<!-- toast -->
<div id="toast" role="status"></div>

<!-- all original JavaScript (exactly as provided, with no changes) -->
<script>
  
// ‚îÄ‚îÄ FB ‚Üí RSS lookup ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const FB_MAP = {
  "nasa":            [{ic:"üöÄ",nm:"NASA Breaking News",url:"https://www.nasa.gov/rss/dyn/breaking_news.rss",tp:"RSS"},{ic:"‚ñ∂Ô∏è",nm:"NASA YouTube",url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCLA_DiR1FfKNvjuUpBHmylQ",tp:"YouTube"}],
  "bbc":             [{ic:"üì∫",nm:"BBC News",url:"https://feeds.bbci.co.uk/news/rss.xml",tp:"RSS"},{ic:"üåç",nm:"BBC World",url:"https://feeds.bbci.co.uk/news/world/rss.xml",tp:"RSS"}],
  "bbc news":        [{ic:"üì∫",nm:"BBC News",url:"https://feeds.bbci.co.uk/news/rss.xml",tp:"RSS"},{ic:"üåç",nm:"BBC World",url:"https://feeds.bbci.co.uk/news/world/rss.xml",tp:"RSS"}],
  "bbcnews":         [{ic:"üì∫",nm:"BBC News",url:"https://feeds.bbci.co.uk/news/rss.xml",tp:"RSS"}],
  "cnn":             [{ic:"üì°",nm:"CNN Top Stories",url:"https://rss.cnn.com/rss/cnn_topstories.rss",tp:"RSS"},{ic:"üí∞",nm:"CNN Business",url:"https://rss.cnn.com/rss/money_news_international.rss",tp:"RSS"}],
  "reuters":         [{ic:"üì∞",nm:"Reuters Top News",url:"https://feeds.reuters.com/reuters/topNews",tp:"RSS"}],
  "al jazeera":      [{ic:"üåê",nm:"Al Jazeera",url:"https://www.aljazeera.com/xml/rss/all.xml",tp:"RSS"}],
  "aljazeera":       [{ic:"üåê",nm:"Al Jazeera",url:"https://www.aljazeera.com/xml/rss/all.xml",tp:"RSS"}],
  "guardian":        [{ic:"üì∞",nm:"The Guardian World",url:"https://www.theguardian.com/world/rss",tp:"RSS"}],
  "the guardian":    [{ic:"üì∞",nm:"The Guardian World",url:"https://www.theguardian.com/world/rss",tp:"RSS"}],
  "npr":             [{ic:"üéô",nm:"NPR News",url:"https://feeds.npr.org/1001/rss.xml",tp:"RSS"}],
  "techcrunch":      [{ic:"üíª",nm:"TechCrunch",url:"https://techcrunch.com/feed/",tp:"RSS"}],
  "verge":           [{ic:"‚ö°",nm:"The Verge",url:"https://www.theverge.com/rss/index.xml",tp:"RSS"}],
  "the verge":       [{ic:"‚ö°",nm:"The Verge",url:"https://www.theverge.com/rss/index.xml",tp:"RSS"}],
  "wired":           [{ic:"üí°",nm:"Wired",url:"https://www.wired.com/feed/rss",tp:"RSS"}],
  "ars technica":    [{ic:"üîß",nm:"Ars Technica",url:"https://feeds.arstechnica.com/arstechnica/index",tp:"RSS"}],
  "hacker news":     [{ic:"üü†",nm:"Hacker News",url:"https://hnrss.org/frontpage",tp:"RSS"}],
  "national geographic":[{ic:"üåç",nm:"Nat Geographic",url:"https://www.nationalgeographic.com/latest-stories/_jcr_content/list.rss",tp:"RSS"}],
  "natgeo":          [{ic:"üåç",nm:"Nat Geographic",url:"https://www.nationalgeographic.com/latest-stories/_jcr_content/list.rss",tp:"RSS"}],
  "science daily":   [{ic:"üî¨",nm:"Science Daily",url:"https://www.sciencedaily.com/rss/top/science.xml",tp:"RSS"}],
  "new scientist":   [{ic:"üß™",nm:"New Scientist",url:"https://www.newscientist.com/feed/home/",tp:"RSS"}],
  "cnbc":            [{ic:"üìà",nm:"CNBC",url:"https://www.cnbc.com/id/100003114/device/rss/rss.html",tp:"RSS"}],
  "forbes":          [{ic:"üíº",nm:"Forbes",url:"https://www.forbes.com/feeds/entrepreneur/index.xml",tp:"RSS"}],
  "variety":         [{ic:"üé¨",nm:"Variety",url:"https://variety.com/feed/",tp:"RSS"}],
  "reddit":          [{ic:"üî¥",nm:"r/worldnews",url:"https://www.reddit.com/r/worldnews/hot.rss",tp:"Reddit"},{ic:"üî¥",nm:"r/technology",url:"https://www.reddit.com/r/technology/hot.rss",tp:"Reddit"}],
  "veritasium":      [{ic:"‚ñ∂Ô∏è",nm:"Veritasium",url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCHnyfMqiRRG1u-2MsSQLbXA",tp:"YouTube"}],
  "kurzgesagt":      [{ic:"‚ñ∂Ô∏è",nm:"Kurzgesagt",url:"https://www.youtube.com/feeds/videos.xml?channel_id=UCsXVk37bltHxD1rDPwtNM8Q",tp:"YouTube"}],
};

// ‚îÄ‚îÄ Utils ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const $   = id => document.getElementById(id);
const e   = s  => String(s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");
const ago = d  => {
  if (!d) return "";
  const s = (Date.now() - new Date(d)) / 1000;
  if (s < 60)    return "just now";
  if (s < 3600)  return ~~(s/60)+"m ago";
  if (s < 86400) return ~~(s/3600)+"h ago";
  return ~~(s/86400)+"d ago";
};
const toast = (m, t="") => {
  const n = $("toast"); n.textContent = m;
  n.className = "show " + t;
  clearTimeout(n._t); n._t = setTimeout(() => n.className = "", 3200);
};

// ‚îÄ‚îÄ Theme toggle ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleTheme() {
  const html = document.documentElement;
  const isDark = html.dataset.theme === "dark";
  html.dataset.theme = isDark ? "light" : "dark";
  document.querySelector(".theme-btn").textContent = isDark ? "‚òÄÔ∏è" : "üåô";
  localStorage.setItem("vf-theme", html.dataset.theme);
}
(function() {
  const saved = localStorage.getItem("vf-theme");
  if (saved) {
    document.documentElement.dataset.theme = saved;
    if (saved === "light") document.querySelector(".theme-btn") && (document.querySelector(".theme-btn").textContent = "‚òÄÔ∏è");
  } else if (window.matchMedia?.("(prefers-color-scheme: light)").matches) {
    document.documentElement.dataset.theme = "light";
  }
})();

// ‚îÄ‚îÄ Tab switching ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function tab(id, el) {
  document.querySelectorAll(".tab").forEach(t => {
    t.classList.remove("active");
    t.setAttribute("aria-selected","false");
  });
  el.classList.add("active");
  el.setAttribute("aria-selected","true");
  const onFeed = id === "feed";
  $("toolbar").style.display = onFeed ? "" : "none";
  $("rbar").style.display    = onFeed ? "" : "none";
  $("feed").style.display    = onFeed ? "" : "none";
  const p = $("panel"); p.className = onFeed ? "" : "on";
  if (!onFeed) loadSrcList();
}

// ‚îÄ‚îÄ Feed ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let posts=[], cats=[], srcs=[], curCat="all";

async function loadPosts() {
  showSpin();
  try {
    const r = await fetch("/api/posts");
    if (!r.ok) throw new Error("HTTP " + r.status);
    const d = await r.json();
    posts = d.posts || [];

    const nc = [...new Set(posts.map(p=>p.category).filter(Boolean))].sort();
    if (JSON.stringify(nc) !== JSON.stringify(cats)) {
      cats = nc;
      const pp = $("cpills"); pp.innerHTML = "";
      ["all", ...cats].forEach(c => {
        const div = document.createElement("div");
        div.className = "pill" + (c === curCat ? " active" : "");
        div.dataset.c = c;
        div.textContent = c === "all" ? "All" : c;
        div.setAttribute("role","button");
        div.setAttribute("tabindex","0");
        div.onclick = () => setCat(div);
        div.onkeydown = ev => { if (ev.key === "Enter" || ev.key === " ") setCat(div) };
        pp.appendChild(div);
      });
    }

    const ns = [...new Set(posts.map(p=>p.page))].sort();
    if (JSON.stringify(ns) !== JSON.stringify(srcs)) {
      srcs = ns;
      const sel = $("sf"); sel.innerHTML = '<option value="all">All Sources</option>';
      srcs.forEach(s => { const o = document.createElement("option"); o.value = s; o.textContent = s; sel.appendChild(o); });
    }
    filter();
  } catch(err) {
    showEmpty("Could not load posts. Is the server running?\n" + err.message);
  }
}

function filter() {
  const q   = $("q").value.toLowerCase();
  const src = $("sf").value;
  const srt = $("so").value;

  let f = posts.filter(p => {
    const cok = curCat==="all" || p.category===curCat;
    const sok = src==="all"    || p.page===src;
    const qok = !q || (p.message||"").toLowerCase().includes(q) || (p.description||"").toLowerCase().includes(q);
    return cok && sok && qok;
  });

  if (srt === "source") f.sort((a,b) => a.page.localeCompare(b.page));
  else f.sort((a,b) => new Date(b.createdTime) - new Date(a.createdTime));

  $("rbar").textContent = f.length ? `Showing ${f.length.toLocaleString()} article${f.length!==1?"s":""}` : "";
  render(f);
}

function render(list) {
  const feed = $("feed");
  if (!list.length) { showEmpty("No articles yet ‚Äî click ‚ö° Fetch Now or add sources in Source Manager."); return; }
  const frag = document.createDocumentFragment();
  list.forEach(p => frag.appendChild(mkCard(p)));
  feed.innerHTML = ""; feed.appendChild(frag);
}

function mkCard(p) {
  const card = document.createElement("div");
  card.className = "card";
  card.setAttribute("role","article");
  const col  = p.color || "#3b82f6";
  const tp   = p.sourceType || p.mediaType || "";
  const badge = tp==="youtube"?"‚ñ∂ YouTube":tp==="reddit"?"Reddit":tp==="video"?"‚ñ∂ Video":tp==="photo"?"Photo":"";
  const thumb = p.mediaUrl
    ? `<img src="${e(p.mediaUrl)}" alt="" loading="lazy" onerror="this.parentElement.innerHTML='<div class=no-image><span>üì∞</span><span>${e(p.page)}</span></div>'">`
    : `<div class="no-image"><span>üì∞</span><span>${e(p.page)}</span></div>`;
  card.innerHTML = `
    <div class="thumb">
      <div class="thumb-stripe" style="background:${col}"></div>
      ${thumb}
      ${badge?`<div class="thumb-badge">${badge}</div>`:""}
    </div>
    <div class="card-content">
      <div class="meta">
        <span class="source-dot" style="background:${col}"></span>
        <span class="source-name">${e(p.page)}</span>
        <span class="time">${ago(p.createdTime)}</span>
      </div>
      <div class="title">${e(p.message)}</div>
      ${p.description&&p.description!==p.message?`<div class="desc">${e(p.description)}</div>`:""}
      ${p.permalink?`<div class="card-footer"><a class="read-link" href="${e(p.permalink)}" target="_blank" rel="noopener noreferrer">Read article <span>‚Üí</span></a></div>`:""}
    </div>`;
  return card;
}

function setCat(el) {
  document.querySelectorAll(".pill").forEach(p => p.classList.remove("active"));
  el.classList.add("active");
  curCat = el.dataset.c;
  filter();
}

function showSpin() {
  $("feed").innerHTML = `<div class="fullcol empty-state"><div class="spin"></div><p>Fetching latest articles‚Ä¶</p></div>`;
  $("rbar").textContent = "";
}

function showEmpty(m) {
  $("feed").innerHTML = `<div class="fullcol empty-state"><span style="font-size:2.5rem">üì≠</span><p>${m}</p></div>`;
  $("rbar").textContent = "";
}

async function fetchNow() {
  const btn = $("fbtn"); btn.disabled = true; btn.textContent = "‚è≥ Fetching‚Ä¶";
  try {
    const r = await fetch("/api/fetch-now", {method:"POST"});
    const d = await r.json();
    if (d.success) { toast(`‚úì ${d.fetched} articles fetched!`, "ok"); await Promise.all([loadPosts(), loadStats()]); }
    else toast("‚ö†Ô∏è " + d.error, "err");
  } catch { toast("Network error ‚Äî check server", "err"); }
  btn.disabled = false; btn.textContent = "‚ö° Fetch Now";
}

async function loadStats() {
  try {
    const [sr, nr] = await Promise.all([fetch("/api/stats"), fetch("/api/next-run")]);
    const s = await sr.json(); const n = await nr.json();
    $("st").textContent = (s.totalPosts||0).toLocaleString();
    $("si").textContent = (s.withImages||0).toLocaleString();
    $("ss").textContent = (s.sources?.length||0).toLocaleString();
    $("sc").textContent = (s.categories?.length||0).toLocaleString();
    $("su").textContent = s.lastFetched ? ago(s.lastFetched) : "Never";
    if (n.nextRun) $("next-lbl").textContent = "Next at " + new Date(n.nextRun).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});
  } catch {}
}

// ‚îÄ‚îÄ Source Manager ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function findAlt() {
  const raw = $("fbin").value.trim().toLowerCase()
    .replace(/https?:\/\/(www\.)?facebook\.com\//i,"").replace(/\//g,"");
  const box = $("altbox");
  if (!raw) return;
  let alts = FB_MAP[raw];
  if (!alts) {
    for (const [k,v] of Object.entries(FB_MAP)) {
      if (k.includes(raw)||raw.includes(k)) { alts = v; break; }
    }
  }
  if (!alts) {
    box.innerHTML=`<div class="rbox warn on" style="margin-top:12px"><div class="rtitle">‚ö†Ô∏è No known feed for "${e(raw)}"</div><div class="rtip">Visit site ‚Üí look for RSS ‚Üí paste URL in "Test a Feed URL".</div></div>`;
    return;
  }
  box.innerHTML=`<p style="font-size:.75rem;color:var(--text-tertiary);margin:8px 0">${alts.length} feed${alts.length>1?"s":""} found ‚Äî click to use:</p>`;
  const list = document.createElement("div"); list.className = "alts";
  alts.forEach(a => {
    const row = document.createElement("div"); row.className = "altrow";
    row.setAttribute("role","button"); row.setAttribute("tabindex","0");
    row.innerHTML=`<span>${a.ic}</span><div style="flex:1"><div><strong>${e(a.nm)}</strong> <span style="font-size:0.6rem;color:var(--text-tertiary)">${a.tp}</span></div><div style="font-size:0.7rem">${e(a.url)}</div></div><span style="color:var(--accent-text)">Use ‚Üí</span>`;
    row.onclick = () => {
      $("aurl").value = a.url; $("aname").value = a.nm;
      $("acat").value = a.tp==="YouTube"?"YouTube":a.tp==="Reddit"?"Reddit":"World";
      toast("Feed loaded ‚Äî verify then click Add Source", "ok");
    };
    row.onkeydown = ev => { if (ev.key==="Enter"||ev.key===" ") row.click() };
    list.appendChild(row);
  });
  box.appendChild(list);
}

async function testFeed() {
  const url = $("turl").value.trim();
  if (!url) { toast("Enter a URL first","err"); return; }
  const btn = $("tbtn"); btn.disabled = true; btn.textContent = "Testing‚Ä¶";
  const box = $("tbox"); box.className = "rbox on"; box.innerHTML = "<div style='color:var(--text-tertiary)'>‚è≥ Checking‚Ä¶</div>";
  try {
    const r = await fetch("/api/validate-feed",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url})});
    const d = await r.json();
    if (d.ok) {
      box.className = "rbox ok on";
      box.innerHTML = `<div><strong>‚úÖ ${e(d.title)}</strong></div><div class="rmeta" style="display:flex;gap:8px;margin-top:6px"><span>üìÑ ${d.itemCount} items</span><span>üì° ${d.feedType}</span></div>`;
      $("aurl").value = url;
      if (!$("aname").value) $("aname").value = d.title||"";
    } else {
      box.className = `rbox ${d.isFacebookDead?"warn":"err"} on`;
      box.innerHTML = `<div><strong>‚ùå Feed error</strong></div><div>${e(d.error)}</div>`;
    }
  } catch(err) {
    box.className="rbox err on";
    box.innerHTML=`<div><strong>‚ùå Error</strong></div><div>${e(err.message)}</div>`;
  }
  btn.disabled=false; btn.textContent="Test Feed";
}

async function addSrc() {
  const name  = $("aname").value.trim();
  const url   = $("aurl").value.trim();
  const cat   = $("acat").value.trim() || "Custom";
  const col   = $("acolor").value;
  if (!name||!url) { toast("Name and URL are required","err"); return; }
  const btn = $("abtn"); btn.disabled=true; btn.textContent="Adding‚Ä¶";
  const box = $("abox"); box.className="rbox on"; box.innerHTML="<div style='color:var(--text-tertiary)'>‚è≥ Validating‚Ä¶</div>";
  try {
    const r = await fetch("/api/add-source",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name,url,category:cat,color:col})});
    const d = await r.json();
    if (d.ok) {
      box.className="rbox ok on";
      box.innerHTML=`<div>‚úÖ "${e(name)}" added!</div>`;
      $("aname").value=""; $("aurl").value=""; $("acat").value="";
      loadSrcList(); toast(`"${name}" added ‚Äî click Fetch Now`,"ok");
    } else {
      box.className="rbox err on";
      box.innerHTML=`<div>‚ùå ${e(d.error)}</div>`;
    }
  } catch(err) {
    box.className="rbox err on"; box.innerHTML=`<div>‚ùå ${e(err.message)}</div>`;
  }
  btn.disabled=false; btn.textContent="Add Source";
}

async function loadSrcList() {
  const list = $("srclist");
  try {
    const r = await fetch("/api/sources"); const d = await r.json();
    if (!d.sources?.length) {
      list.innerHTML=`<div style="color:var(--text-tertiary);padding:8px">No sources yet.</div>`;
      return;
    }
    list.innerHTML="";
    d.sources.forEach(s => {
      const row = document.createElement("div");
      row.className="srcrow";
      row.innerHTML=`<span style="width:8px;height:8px;border-radius:50%;background:${e(s.color)}"></span><div style="flex:1"><div>${e(s.name)}</div><div style="font-size:0.7rem">${e(s.url)}</div></div><span style="font-size:0.65rem">${e(s.category)}</span><button class="srcrm" onclick="rmSrc('${e(s.name)}')">‚úï</button>`;
      list.appendChild(row);
    });
  } catch {
    list.innerHTML=`<div style="color:var(--text-tertiary)">Could not load sources.</div>`;
  }
}

async function rmSrc(name) {
  if (!confirm(`Remove "${name}"?`)) return;
  try {
    await fetch(`/api/remove-source/${encodeURIComponent(name)}`,{method:"DELETE"});
    toast(`"${name}" removed`,"ok"); loadSrcList();
  } catch { toast("Failed to remove","err"); }
}

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
loadPosts();
loadStats();
setInterval(loadStats, 30000);

const ribbon = document.getElementById('ribbon');
    const cards = ribbon.querySelectorAll('.stat-card');
    const speed = 1.5; // pixels per frame - adjust for speed

    let isPaused = false;
    let animationId = null;

    // Get the total width of one card including gap
    function getCardWidth(card) {
      return card.offsetWidth + 24; // 24px gap
    }

    // Animation loop - 360¬∞ circular movement
    function animate() {
      if (!isPaused) {
        const firstCard = ribbon.querySelector('.stat-card');
        
        // Move the ribbon left (cards move right to left)
        const currentLeft = parseFloat(ribbon.style.left) || 0;
        ribbon.style.left = (currentLeft - speed) + 'px';

        // Check if first card is completely out of view (left side)
        const firstCardRect = firstCard.getBoundingClientRect();
        const wrapperRect = ribbon.parentElement.getBoundingClientRect();

        // When first card exits left edge, move it to the end
        if (firstCardRect.right < wrapperRect.left - 10) {
          // Move first card to the end
          ribbon.appendChild(firstCard);
          // Reset position to account for the moved card
          ribbon.style.left = (currentLeft + getCardWidth(firstCard)) + 'px';
        }
      }

      animationId = requestAnimationFrame(animate);
    }

    // Initialize
    ribbon.style.position = 'relative';
    ribbon.style.left = '0px';
    ribbon.style.width = 'max-content';

    // Pause on hover
    ribbon.addEventListener('mouseenter', () => {
      isPaused = true;
    });

    ribbon.addEventListener('mouseleave', () => {
      isPaused = false;
    });

    // Start animation
    animate();

    // Reduce motion preference
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      cancelAnimationFrame(animationId);
    }
</script>
</body>
</html>